{% extends "base.html" %}
{% block title %}IndFlow — Dashboard{% endblock %}

{% block content %}
<div class="dashboard-wrapper">

  <style>
    .dashboard-wrapper{
      width:100%;
      display:flex;
      justify-content:center;
      padding:32px 0;
    }

    /* CARD INDUSTRIAL */
    .machine-card{
      background:#ffffff;
      width:380px;
      border-radius:16px;
      padding:28px;
      box-shadow:0 4px 14px rgba(0,0,0,0.10);
      display:flex;
      flex-direction:column;
      gap:20px;
      border:1px solid #e5e7eb;

      cursor:pointer;
      transition:0.15s ease-in-out;
    }

    .machine-card:hover{
      transform:translateY(-3px);
      box-shadow:0 6px 18px rgba(0,0,0,0.14);
    }

    .machine-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .machine-name{
      font-size:22px;
      font-weight:600;
    }

    .machine-status{
      font-size:14px;
      font-weight:600;
      padding:6px 12px;
      border-radius:6px;
      color:white;
    }

    .status-auto{ background:#16a34a; }
    .status-manual{ background:#dc2626; }

    .machine-percent{
      font-size:72px;
      font-weight:700;
      text-align:center;
      color:#0f172a;
      line-height:1;
    }

    .machine-stats{
      display:flex;
      justify-content:space-between;
      font-size:16px;
      color:#334155;
      font-weight:500;
    }

    .machine-stats span b{
      font-weight:700;
      color:#0f172a;
    }
  </style>

  <!-- CARD CLICÁVEL -->
  <div class="machine-card" onclick="abrirConfig('maquina01')">

    <div class="machine-header">
      <div class="machine-name" id="nome">MAQUINA 01</div>

      <div id="statusBadge" class="machine-status status-auto">
        AUTOMÁTICO
      </div>
    </div>

    <div class="machine-percent" id="percentual">
      0%
    </div>

    <div class="machine-stats">
      <span>Meta: <b id="meta_turno">0</b></span>
      <span>Produzido: <b id="producao_turno">0</b></span>
    </div>

  </div>

</div>

<script>
function abrirConfig(id){
  window.location.href = "/producao/config/" + id;
}

// Atualização periódica dos dados
async function atualizarCard(){
  try{
    const res = await fetch("/machine/status?id=maquina01");
    const data = await res.json();

    document.getElementById("nome").textContent = data.nome;
    document.getElementById("percentual").textContent = data.percentual + "%";
    document.getElementById("meta_turno").textContent = data.meta_turno;
    document.getElementById("producao_turno").textContent = data.producao_turno;

    let badge = document.getElementById("statusBadge");
    badge.textContent = data.status;

    if(data.status === "AUTO" || data.status === "AUTOMÁTICO"){
      badge.className = "machine-status status-auto";
    } else {
      badge.className = "machine-status status-manual";
    }

  }catch(e){
    console.log("Erro ao atualizar card:", e);
  }
}

// Atualiza a cada 2s
setInterval(atualizarCard, 2000);
atualizarCard();
</script>

{% endblock %}
