{% extends "base.html" %}
{% block title %}IndFlow — Dashboard{% endblock %}

{% block content %}

<div class="dashboard-wrapper">

  <style>
    .dashboard-wrapper{
      width:100%;
      display:flex;
      justify-content:center;
      padding:32px 0;
    }

    .machine-card{
      background:#ffffff;
      width:440px;
      border-radius:20px;
      padding:28px;
      box-shadow:0 4px 14px rgba(0,0,0,0.12);
      display:flex;
      flex-direction:column;
      gap:22px;
      border:1px solid #e5e7eb;
      cursor:pointer;
      transition:0.15s;
    }

    .machine-card:hover{
      box-shadow:0 6px 18px rgba(0,0,0,0.2);
      transform:translateY(-2px);
    }

    .machine-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .machine-name{
      font-size:24px;
      font-weight:700;
      color:#0f172a;
    }

    .machine-status{
      font-size:14px;
      font-weight:600;
      padding:8px 14px;
      border-radius:6px;
      color:white;
      text-transform:uppercase;
    }

    .status-auto{ background:#16a34a; }
    .status-manual{ background:#dc2626; }

    /* BLOCO TURNO / HORA */
    .stats-container{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-top:10px;
    }

    .stats-block{
      width:45%;
    }

    .stats-title{
      font-size:16px;
      font-weight:700;
      color:#475569;
      margin-bottom:10px;
      text-align:center;
    }

    .stats-line{
      display:flex;
      justify-content:space-between;
      font-size:18px;
      font-weight:600;
      color:#334155;
      margin-bottom:6px;
    }

    .stats-line b{
      font-weight:700;
      color:#0f172a;
    }

    .percent-small{
      text-align:center;
      margin-top:8px;
      font-size:20px;
      font-weight:700;
      color:#0f172a;
    }

    .divider{
      width:2px;
      height:120px;
      background:#cbd5e1;
      border-radius:2px;
    }
  </style>

  <!-- CARD -->
  <div class="machine-card" onclick="window.location.href='/producao/config/maquina01'">

    <div class="machine-header">
      <div class="machine-name">MAQUINA 01</div>
      <div id="status-badge" class="machine-status status-auto">AUTO</div>
    </div>

    <div class="stats-container">

      <!-- TURNO -->
      <div class="stats-block">
        <div class="stats-title">TURNO</div>

        <div class="stats-line">
          <span>Meta</span>
          <b id="meta-turno">0</b>
        </div>

        <div class="stats-line">
          <span>Produzido</span>
          <b id="prod-turno">0</b>
        </div>

        <div class="percent-small" id="percent-turno">0%</div>
      </div>

      <div class="divider"></div>

      <!-- HORA -->
      <div class="stats-block">
        <div class="stats-title">HORA</div>

        <div class="stats-line">
          <span>Meta</span>
          <b id="meta-hora">0</b>
        </div>

        <div class="stats-line">
          <span>Produzido</span>
          <b id="prod-hora">0</b>
        </div>

        <div class="percent-small" id="percent-hora">0%</div>
      </div>

    </div>

  </div>

</div>

<script>
function atualizarDashboard(){

  fetch("/machine/status")
    .then(r => r.json())
    .then(data => {

      // STATUS
      let statusBadge = document.getElementById("status-badge");
      statusBadge.textContent = data.status;
      statusBadge.className =
        "machine-status " + (data.status === "AUTO" ? "status-auto" : "status-manual");

      // TURNO
      document.getElementById("meta-turno").textContent = data.meta_turno;
      document.getElementById("prod-turno").textContent = data.producao_turno;
      document.getElementById("percent-turno").textContent = data.percentual_turno + "%";

      // HORA
      document.getElementById("meta-hora").textContent = data.meta_por_hora?.[data.ultima_hora] ?? 0;
      document.getElementById("prod-hora").textContent = data.producao_hora;
      document.getElementById("percent-hora").textContent = data.percentual_hora + "%";

    });
}

// Atualização temporizada (estável)
setInterval(atualizarDashboard, 1000);
atualizarDashboard();
</script>

{% endblock %}
