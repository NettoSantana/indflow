fix(historico): gerar segmentos RUN/STOP via machine_state_event no detalhe-dia

- Converte machine_state_event (transicoes RUN/STOP/NP) em intervalos RUN por dia
- Mantem rastro real das cores (verde/vermelho/cinza) no historico sem depender de meta/calculo
- Fallback seguro: se nao existir tabela/eventos, mantem comportamento anterior (STOP/NP)
